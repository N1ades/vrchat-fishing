# Обновление: Прямой захват звука из VRChat

## Что изменилось?

### ✅ Главное улучшение
Бот теперь **захватывает звук напрямую из процесса VRChat** через Windows Audio Session API, вместо использования микрофона!

### Преимущества нового подхода:

1. **Не требуется настройка микрофона** - забудьте о VoiceMeeter и других виртуальных аудио микшерах
2. **Более точное обнаружение звуков** - нет посторонних шумов, только звуки VRChat
3. **Проще в использовании** - просто убедитесь, что VRChat воспроизводит звук
4. **Меньше ложных срабатываний** - улучшенная фильтрация с cooldown между обнаружениями
5. **Работает в фоне** - не важно, какой у вас микрофон или есть ли он вообще

## Как обновить?

### Шаг 1: Установите новые зависимости
```bash
pip install pycaw comtypes
```

Или запустите заново:
```bash
install_dependencies.bat
```

### Шаг 2: Запустите бота
```bash
python vrchat_fishing_bot.py
```

Или двойным кликом:
```
run_bot.bat
```

## Новые настройки

### Порог громкости
- **Старое значение**: 0.3
- **Новое значение по умолчанию**: 0.15
- **Диапазон**: 0.01 - 1.0 (теперь с шагом 0.01)

Почему изменилось? Прямой захват звука дает более точные значения громкости, поэтому порог стал ниже.

### Рекомендуемые значения:
- **0.05-0.15** - для тихих звуков клева
- **0.15-0.30** - для обычных звуков (рекомендуется)
- **0.30+** - для очень громких звуков

## Что проверить после обновления?

1. ✅ VRChat запущен и **воспроизводит звук**
2. ✅ В логе бота появляется сообщение "Найдена аудио сессия VRChat"
3. ✅ Сообщение "Запущен мониторинг аудио из VRChat"
4. ✅ Бот обнаруживает звуки клева

## Устранение проблем

### "Аудио сессия VRChat не найдена"
**Решение:**
- Убедитесь, что VRChat воспроизводит звук
- Откройте микшер громкости Windows (Win + G → Аудио) и проверьте, что VRChat не отключен
- Перезапустите VRChat с включенным звуком
- Перезапустите бота

### Звуки не обнаруживаются
**Решение:**
- Понизьте порог громкости до 0.05-0.10
- Проверьте, что в логе есть сообщение "Запущен мониторинг аудио из VRChat"
- Убедитесь, что громкость VRChat в Windows не на минимуме
- Попробуйте увеличить громкость игры в настройках VRChat

### Слишком много ложных срабатываний
**Решение:**
- Увеличьте порог громкости до 0.20-0.30
- Бот уже имеет защиту от дублирования (cooldown 0.5 сек между обнаружениями)
- Убедитесь, что используете последнюю версию

## Технические детали

### Новые библиотеки:
- **pycaw** - Python Core Audio Windows Library для работы с Windows Audio API
- **comtypes** - COM интерфейсы для взаимодействия с Windows

### Что изменилось в коде:
1. Добавлен поиск процесса VRChat через `win32process`
2. Добавлен поиск аудио сессии через `AudioUtilities.GetAllSessions()`
3. Использование `IAudioMeterInformation` для получения peak value
4. Экспоненциальное сглаживание громкости для стабильности
5. Cooldown между обнаружениями звуков (0.5 сек)
6. Порог тишины для игнорирования фонового шума

## Обратная совместимость

Старые настройки из GUI сохранены, но значения порога громкости нужно будет скорректировать:
- Если у вас было **0.3** → попробуйте **0.15**
- Если у вас было **0.5** → попробуйте **0.25**
- Если у вас было **0.2** → попробуйте **0.10**

## Вопросы и поддержка

Если возникли проблемы, проверьте:
1. VRChat воспроизводит звук (проверьте в микшере громкости Windows)
2. Установлены все зависимости: `pip install -r requirements.txt`
3. Бот запущен от имени администратора (если проблемы с нажатием клавиш)
4. В логе бота нет ошибок

---

**Версия:** 2.0 - Прямой захват аудио  
**Дата:** 30 октября 2025