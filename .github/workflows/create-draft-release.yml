name: Create Draft Release

# –°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–∞ —Ä–µ–ª–∏–∑–∞ –≤—Ä—É—á–Ω—É—é
on:
  workflow_dispatch:
    inputs:
      version:
        description: '–í–µ—Ä—Å–∏—è —Ä–µ–ª–∏–∑–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 1.0.0)'
        required: true
        type: string
      prerelease:
        description: '–ü—Ä–µ-—Ä–µ–ª–∏–∑ (–±–µ—Ç–∞-–≤–µ—Ä—Å–∏—è)?'
        required: false
        type: boolean
        default: false

jobs:
  build-and-draft:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build EXE
      run: |
        python -m PyInstaller --noconfirm `
          --onefile `
          --windowed `
          --name "VRChat_Fishing_Bot" `
          --icon=NONE `
          --add-data "fishing_bot_settings.json;." `
          --hidden-import "comtypes.stream" `
          --hidden-import "pycaw.pycaw" `
          --hidden-import "pycaw.utils" `
          --hidden-import "win32gui" `
          --hidden-import "win32con" `
          --hidden-import "win32api" `
          --hidden-import "win32process" `
          --hidden-import "pyaudio" `
          --hidden-import "numpy" `
          --hidden-import "tkinter" `
          --collect-all "pycaw" `
          --collect-all "comtypes" `
          vrchat_fishing_bot.py
          
    - name: Create Release Package
      run: |
        mkdir release
        copy dist\VRChat_Fishing_Bot.exe release\
        copy fishing_bot_settings.json release\
        copy README.md release\
        copy QUICK_START.txt release\
        
    - name: Create ZIP archive
      run: |
        Compress-Archive -Path release\* -DestinationPath "VRChat_Fishing_Bot_v${{ inputs.version }}.zip"
        
    - name: Create Draft Release
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v${{ inputs.version }}
        name: VRChat Fishing Bot v${{ inputs.version }}
        files: |
          VRChat_Fishing_Bot_v${{ inputs.version }}.zip
          release/VRChat_Fishing_Bot.exe
          release/fishing_bot_settings.json
        body: |
          ## VRChat Fishing Bot v${{ inputs.version }}
          
          ### üì¶ –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:
          - `VRChat_Fishing_Bot.exe` - –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
          - `fishing_bot_settings.json` - –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
          - `README.md` - –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
          - `QUICK_START.txt` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
          
          ### üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
          
          **–í–∞—Ä–∏–∞–Ω—Ç 1: –°–∫–∞—á–∞—Ç—å ZIP –∞—Ä—Ö–∏–≤**
          1. –°–∫–∞—á–∞–π—Ç–µ `VRChat_Fishing_Bot_v${{ inputs.version }}.zip`
          2. –†–∞—Å–ø–∞–∫—É–π—Ç–µ –≤ –ª—é–±—É—é –ø–∞–ø–∫—É
          3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `VRChat_Fishing_Bot.exe`
          
          **–í–∞—Ä–∏–∞–Ω—Ç 2: –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ –æ—Ç–¥–µ–ª—å–Ω–æ—Å—Ç–∏**
          1. –°–∫–∞—á–∞–π—Ç–µ `VRChat_Fishing_Bot.exe` –∏ `fishing_bot_settings.json`
          2. –ü–æ–º–µ—Å—Ç–∏—Ç–µ –æ–±–∞ —Ñ–∞–π–ª–∞ –≤ –æ–¥–Ω—É –ø–∞–ø–∫—É
          3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `VRChat_Fishing_Bot.exe`
          
          ### ‚öôÔ∏è –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
          - Windows 10/11 (64-bit)
          - ~50 –ú–ë —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
          - Python **–ù–ï —Ç—Ä–µ–±—É–µ—Ç—Å—è**!
          
          ### üìù Changelog:
          
          #### ‚ú® –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
          - TODO: –û–ø–∏—à–∏—Ç–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
          
          #### üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
          - TODO: –û–ø–∏—à–∏—Ç–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏
          
          #### üîß –£–ª—É—á—à–µ–Ω–∏—è:
          - TODO: –û–ø–∏—à–∏—Ç–µ —É–ª—É—á—à–µ–Ω–∏—è
          
          ### üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
          - [README](README.md) - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
          - [QUICK_START](QUICK_START.txt) - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
          
          ### ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
          - TODO: –û–ø–∏—à–∏—Ç–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã (–µ—Å–ª–∏ –µ—Å—Ç—å)
          
          ### üí¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å:
          –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã, —Å–æ–∑–¥–∞–π—Ç–µ Issue –Ω–∞ GitHub.
          
          ---
          
          **–°–±–æ—Ä–∫–∞**: Windows | Python 3.11 | PyInstaller 6.x
          **–î–∞—Ç–∞**: ${{ github.event.repository.updated_at }}
        draft: true
        prerelease: ${{ inputs.prerelease }}
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Summary
      run: |
        Write-Host "================================"
        Write-Host "‚úì Draft Release Created!"
        Write-Host "================================"
        Write-Host "Version: v${{ inputs.version }}"
        Write-Host "Pre-release: ${{ inputs.prerelease }}"
        Write-Host ""
        Write-Host "Next steps:"
        Write-Host "1. Go to Releases page on GitHub"
        Write-Host "2. Edit the draft release"
        Write-Host "3. Update changelog"
        Write-Host "4. Publish when ready"
        Write-Host "================================"
