name: Build and Release

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–µ–≥–∞ –∏–ª–∏ –≤—Ä—É—á–Ω—É—é
on:
  push:
    tags:
      - 'v*.*.*'  # –ù–∞–ø—Ä–∏–º–µ—Ä: v1.0.0, v2.1.3
  workflow_dispatch:  # –ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å –≤—Ä—É—á–Ω—É—é

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        pip install pyinstaller
        
    - name: Build EXE
      run: |
        python -m PyInstaller --noconfirm `
          --onefile `
          --windowed `
          --name "VRChat_Fishing_Bot" `
          --icon=NONE `
          --add-data "fishing_bot_settings.json;." `
          --hidden-import "comtypes.stream" `
          --hidden-import "pycaw.pycaw" `
          --hidden-import "pycaw.utils" `
          --hidden-import "win32gui" `
          --hidden-import "win32con" `
          --hidden-import "win32api" `
          --hidden-import "win32process" `
          --hidden-import "pyaudio" `
          --hidden-import "numpy" `
          --hidden-import "tkinter" `
          --collect-all "pycaw" `
          --collect-all "comtypes" `
          vrchat_fishing_bot.py
          
    - name: Create Release Package
      run: |
        mkdir release
        copy dist\VRChat_Fishing_Bot.exe release\
        copy fishing_bot_settings.json release\
        copy README.md release\
        copy QUICK_START.txt release\
        
    - name: Archive Release
      uses: actions/upload-artifact@v4
      with:
        name: VRChat_Fishing_Bot
        path: release/
        
    - name: Create Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      with:
        files: |
          release/VRChat_Fishing_Bot.exe
          release/fishing_bot_settings.json
          release/README.md
          release/QUICK_START.txt
        body: |
          ## VRChat Fishing Bot Release
          
          ### üì¶ –ß—Ç–æ –≤–∫–ª—é—á–µ–Ω–æ:
          - `VRChat_Fishing_Bot.exe` - –û—Å–Ω–æ–≤–Ω–æ–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
          - `fishing_bot_settings.json` - –§–∞–π–ª –Ω–∞—Å—Ç—Ä–æ–µ–∫ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
          - `README.md` - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
          - `QUICK_START.txt` - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
          
          ### üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞:
          1. –°–∫–∞—á–∞–π—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã
          2. –ü–æ–º–µ—Å—Ç–∏—Ç–µ –∏—Ö –≤ –æ–¥–Ω—É –ø–∞–ø–∫—É
          3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `VRChat_Fishing_Bot.exe`
          
          ### ‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
          - Windows 10/11
          - Python –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ **–ù–ï —Ç—Ä–µ–±—É—é—Ç—Å—è**!
          
          ### üìù Changelog:
          –°–º. –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–º–º–∏—Ç–∞—Ö
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
